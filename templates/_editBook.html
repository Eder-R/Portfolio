<div class="container d-flex justify-content-center align-items-center min-vh-100">
  <h1>Alterar livro</h1>
  <form id="bookForm" class="filter-form">
    <div class="form-group">

      <label for="nomeLivro">Nome do Livro:</label>
      <input type="text" id="nomeLivro">
      <br>
      
      <label for="autorLivro">Autor do Livro:</label>
      <input type="text" id="autorLivro">
      <br>
      
      <label for="generoLivro">Gênero do Livro:</label>
      <input type="text" id="generoLivro">
      <br>
      
      <label for="statusLivro">Status do Livro:</label>
      <select id="statusLivro" onchange="toggleNomePessoa()">
        <option value="false">Não Emprestado</option>
        <option value="true">Emprestado</option>
      </select>
      <br>

      <!-- Campo adicional oculto inicialmente -->
      <div id="nomePessoaContainer" style="display: none;">
        <label for="nomePessoa">Nome da Pessoa que Pegou Emprestado:</label>
        <input type="text" id="nomePessoa">
      </div>

      <button type="button" onclick="alterarDadosLivro('{{ livro.id }}')">Alterar Dados</button>

      <button type="button" onclick="deletarLivro('{{ livro.id }}')">Deletar Livro</button>
    </div>
  </form>
</div>

<script>
  function toggleNomePessoa() {
    const statusLivro = document.getElementById('statusLivro').value;
    const nomePessoaContainer = document.getElementById('nomePessoaContainer');
    
    if (statusLivro === 'true') {
      nomePessoaContainer.style.display = 'block';
    } else {
      nomePessoaContainer.style.display = 'none';
      document.getElementById('nomePessoa').value = ''; // Limpa o campo ao ocultá-lo
    }
  }

  function alterarDadosLivro(id) {
    const nomeLivro = document.getElementById('nomeLivro').value.trim();
    const autorLivro = document.getElementById('autorLivro').value.trim();
    const generoLivro = document.getElementById('generoLivro').value.trim();
    const statusLivro = document.getElementById('statusLivro').value;
    const nomePessoa = document.getElementById('nomePessoa').value.trim();

    // Criando um objeto apenas com os campos preenchidos
    let dadosAtualizados = { status: statusLivro };

    if (nomeLivro) dadosAtualizados.nome = nomeLivro;
    if (autorLivro) dadosAtualizados.autor = autorLivro;
    if (generoLivro) dadosAtualizados.genero = generoLivro;
    if (statusLivro === 'true' && nomePessoa) {
      dadosAtualizados.nomePessoa = nomePessoa;
    }

    // Simulação de envio de dados para a API/backend
    fetch(`/api/livros/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(dadosAtualizados)
    })
    .then(response => response.json())
    .then(data => alert("Livro atualizado com sucesso!"))
    .catch(error => console.error("Erro ao atualizar livro:", error));
  }
</script>